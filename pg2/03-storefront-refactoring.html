<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Refactoring :: Programmeren Gevorderd 2 (BETA)</title>
    <meta name="generator" content="Antora 3.1.14">
    <link rel="stylesheet" href="../_/css/site.css">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="#">Programmeren Gevorderd 2 (BETA)</a>
      <button class="navbar-burger" aria-controls="topbar-nav" aria-expanded="false" aria-label="Toggle main menu">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
      
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
          <div class="navbar-item has-dropdown is-hoverable">
              <a class="navbar-link" href="#">Producten</a>
              <div class="navbar-dropdown">
                  <a class="navbar-item" target="_blank" href="https://learn.microsoft.com/en-us/cli/azure/">Azure CLI</a>
                  <a class="navbar-item" target="_blank" href="https://www.docker.com/products/docker-desktop">Docker Desktop</a>
                  <a class="navbar-item" target="_blank" href="https://desktop.github.com/download">GitHub Desktop</a>
                  <a class="navbar-item" target="_blank" href="https://www.mysql.com/products/workbench">MySQL Workbench</a>
                  <a class="navbar-item" target="_blank" href="https://www.postman.com/downloads/">Postman</a>
                  <a class="navbar-item" target="_blank" href="https://www.jetbrains.com/rider/download">Rider</a>
                  <a class="navbar-item" target="_blank" href="https://code.visualstudio.com/download">VS Code</a>
              </div>
          </div>
          <div class="navbar-item has-dropdown is-hoverable">
              <a class="navbar-link" href="#">Diensten</a>
              <div class="navbar-dropdown">
                  <a class="navbar-item" target="_blank" href="https://dev.azure.com/hogent-web4-stefancourteaux/">Azure DevOps</a>
                  <a class="navbar-item" target="_blank" href="https://portal.azure.com">Azure Portal</a>
                  <a class="navbar-item" target="_blank" href="https://chamilo.hogent.be">Chamilo</a>
                  <a class="navbar-item" target="_blank" href="https://github.com">GitHub</a>
                  <a class="navbar-item" target="_blank" href="https://jwt.io">JWT.io</a>                  
                  <a class="navbar-item" target="_blank" href="https://dotnet.microsoft.com">MS Docs</a>
              </div>
          </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="pg2" data-version="">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <button class="nav-menu-toggle" aria-label="Toggle expand/collapse all" style="display: none"></button>
    <h3 class="title"><a href="index.html">Gevorderd 2</a></h3>
<ul class="nav-list">
      <li class="nav-item is-active" data-depth="0">
<ul class="nav-list">
      <li class="nav-item is-active" data-depth="1">
    <a class="nav-link" href="01-http-apis.html">RESTful HTTP Api</a>
  </li>
      <li class="nav-item is-active" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="02-storefront.html">Backend (Api + EF Core)</a>
<ul class="nav-list">
      <li class="nav-item is-active" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="02-storefront-api.html">RESTful Api</a>
<ul class="nav-list">
      <li class="nav-item is-active" data-depth="3">
    <a class="nav-link" href="02-storefront-api-1.html">Customers &amp; Products</a>
  </li>
      <li class="nav-item is-active" data-depth="3">
    <a class="nav-link" href="02-storefront-api-3.html">Orders &amp; Service Layer</a>
  </li>
</ul>
  </li>
      <li class="nav-item is-active" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="03-storefront-ef.html">Database</a>
<ul class="nav-list">
      <li class="nav-item is-active" data-depth="3">
    <a class="nav-link" href="03-storefront-ef-1.html">Werken Met MySQL</a>
  </li>
      <li class="nav-item is-active" data-depth="3">
    <a class="nav-link" href="03-storefront-ef-2.html">EF Core (SQL First) ðŸŒŸ</a>
  </li>
</ul>
  </li>
      <li class="nav-item is-active is-current-page" data-depth="2">
    <a class="nav-link" href="03-storefront-refactoring.html">Refactoring ðŸŒŸ</a>
  </li>
</ul>
  </li>
      <li class="nav-item is-active" data-depth="1">
    <a class="nav-link" href="04-ef-code-first.html">EF Core (Code First)</a>
  </li>
      <li class="nav-item is-active" data-depth="1">
    <a class="nav-link" href="05-dapper.html">Dapper Micro ORM</a>
  </li>
      <li class="nav-item is-active" data-depth="1">
    <a class="nav-link" href="06-async.html">Asynchroon &amp; Parallel Programmeren</a>
  </li>
      <li class="nav-item is-active" data-depth="1">
    <a class="nav-link" href="07-mongo.html">MongoDB</a>
  </li>
      <li class="nav-item is-active" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="90-oefeningen.html">Oefeningen</a>
<ul class="nav-list">
      <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="90-01-herhaling.html">Herhaling C# en UML</a>
  </li>
      <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="90-03-pokemons.html">Backend (Api + In-Memory)</a>
  </li>
      <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="90-02-backend.html">Backend (Api + EF Core)</a>
  </li>
      <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="90-02-backend-voetbal.html">Backend (Api + EF Core)</a>
  </li>
      <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="90-04-fototoestellen.html">EF Core (Code First)</a>
  </li>
      <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="90-05-backend-dapper.html">Dapper</a>
  </li>
      <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="90-06-mongo.html">Api + MongoDB</a>
  </li>
      <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="90-07-alles.html">Cover-All</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Gevorderd 2</span>
    <span class="version"></span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <div class="title"><a href="index.html">Gevorderd 2</a></div>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">Gevorderd 2</a></li>
    <li><a href="02-storefront.html">Backend (Api + EF Core)</a></li>
    <li><a href="03-storefront-refactoring.html">Refactoring ðŸŒŸ</a></li>
  </ul>
</nav>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Refactoring</h1>
<div class="sect1">
<h2 id="_doel"><a class="anchor" href="#_doel"></a>Doel</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Begrijpen wat refactoring is.</p>
</li>
<li>
<p>Elementen van de applicatie <em>refactoren</em>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_refactoring"><a class="anchor" href="#_refactoring"></a>Refactoring</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We hebben in het verleden reeds verschillende delen van de applicatie aangepast en herschreven door het toevoegen van business requirements en het verwerven van nieuwe technische inzichten. Het herschrijven van stukjes code, of aanpassen van het applicatieontwerp, heet <a href="https://en.wikipedia.org/wiki/Code_refactoring"><em>Refactoring</em></a>.</p>
</div>
<div class="paragraph">
<p><em>Refactoring</em> is een normaal, gezond en continue aanwezig onderdeel van het ontwikkelingsproces. Net om die reden is <em>Refactoring</em> altijd impliciet aanwezig in de cursus.
In academische context is het belangrijk de dingen expliciet te benoemen, dus laten we dat hier even doen.</p>
</div>
<div class="paragraph">
<p>In dit hoofdstuk integreren we de gegenereerde <em>Data Access Layer</em> in onze <em>StoreFront</em> applicatie. We hadden ook enkele openstaande verbeterpunten. Dit brengt ons tot volgend overzicht:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Inconsistent gebruik van service layer.</p>
</li>
<li>
<p>Gebruik van api contracts in data layer.</p>
</li>
<li>
<p>Hardcoded connection string in DbContext.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_service_layer"><a class="anchor" href="#_service_layer"></a>Service Layer</h3>
<div class="paragraph">
<p>Op dit moment bestaat er enkel een <em>OrderService</em>. De <em>Api Controllers</em> voor <em>Customers</em> en <em>Products</em> spreken nog rechtstreeks tegen <em>Repositories</em>. Dergelijke inconsistenties zijn onwenselijk.<br>
<br>
<strong>We moeten een <em>CustomerService</em> en een <em>ProductService</em> introduceren.</strong></p>
</div>
</div>
<div class="sect2">
<h3 id="_connectionstring"><a class="anchor" href="#_connectionstring"></a>ConnectionString</h3>
<div class="paragraph">
<p>Op dit moment bevat de gegenereerde <em>DbContext</em> een vaste, leesbare <em>Connectionstring</em> naar onze MySQL databank. <em>Access Credentials</em> bewaren in broncode is niet veilig. Het is ook inflexibel - wat als we met een andere databaseserver willen verbinden?<br>
<br>
<strong>We moeten de <em>Connectionstring</em> verhuizen naar een configuratiebestand.</strong></p>
</div>
<div class="listingblock">
<div class="title">AppSettings.json</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "Logging": {
    "LogLevel": {
      "Default": "Information",
      "Microsoft.AspNetCore": "Warning"
    }
  },
  "ConnectionStrings": {
    "StoreFrontMySQL": "server=127.0.0.1;port=3307;database=schemadag;user=userdag;password=userdag"
  }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Program.cs</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-c# hljs" data-lang="c#">//...
var connectionString = builder.Configuration.GetConnectionString("StoreFrontMySQL");
var serverVersion = new MySqlServerVersion(ServerVersion.AutoDetect(connectionString));
builder.Services.AddDbContext&lt;StorefrontContext&gt;(options =&gt;
    options.UseMySql(connectionString, serverVersion));
//...</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_opschonen_lagenmodel"><a class="anchor" href="#_opschonen_lagenmodel"></a>Opschonen Lagenmodel ðŸŒŸ</h3>
<div class="paragraph">
<p>Op dit moment gebruiken de <em>Repositories</em> in de <em>Data Layer</em> onze <em>Api Contracts</em>. De api contracten mogen niet dieper dan de <em>Service Layer</em> gebruikt worden. Onze contracten zijn immers bedoeld voor de buitenwereld, niet de interne logica.</p>
</div>
<div class="paragraph">
<p>Interne domeinlogica zal al snel nood hebben aan rijkere of anders ontworpen representaties van onze data. We kunnen een bibliotheek van domeinmodellen aanleggen en deze gebruiken in de <em>Service Layer</em>.</p>
</div>
<div class="paragraph">
<p>De persistentielaag bevat intern een rechtstreekse weergave van tabellen en relaties.</p>
</div>
<div class="paragraph">
<p><strong>Doelstelling</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>ApiController en Services naar buiten toe <em>(Api)Contract</em> ~ DTO</p>
</li>
<li>
<p>Service binnenin <em>(Domain)Model</em></p>
</li>
<li>
<p>Persistence binnenin <em>DataModel</em> ~ DAO</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>We moeten ook <strong>kiezen</strong> hoe de mapping tussen Services en Repositories zal lopen.</p>
</div>
<div class="paragraph">
<p>Optie 1: Repo gebruikt intern <strong>data</strong> model, maar haar publieke methodes werken met <strong>domein</strong> model<br>
 &#8594; Mapping gebeurt in Persistence</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/storefront-ef/lagenmodel-repo.jpg" alt="lagenmodel repo">
</div>
</div>
<div class="paragraph">
<p>Optie 2: Repo gebruikt intern <strong>data</strong> model, haar publieke methodes werken met diezelfde <strong>data</strong> model klassen<br>
 &#8594; Mapping gebeurt in Service</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/storefront-ef/lagenmodel-service.jpg" alt="lagenmodel service">
</div>
</div>
<div class="paragraph">
<p>We <strong>kiezen</strong> voor de tweede optie en refactoren de codebase.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/storefront-ef/lagenmodel.png" alt="lagenmodel">
</div>
<div class="title">Figure 1. Een mogelijke eindtoestand van deze solution.</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ervaring"><a class="anchor" href="#_ervaring"></a>Ervaring ðŸŒŸ</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Wat we bekijken tijdens de lessen is <em>een</em> soort probleem dat op <em>een</em> manier opgelost wordt. Er bestaan eindeloos veel problemen, maar we kunnen ze veelal groeperen per soort of type. Elk soort probleem heeft een paar frequent gebruikte oplossingen. Problemen herkennen en vervolgens een passende geijkte oplossing kunnen kiezen en implementeren is een van de belangrijkste <em>tools</em> die een developer op zak kan hebben. Daarom is het nuttig op de hoogte te zijn van design- en architectuur <em>patterns</em>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<strong>Programmeren</strong> is een (van de) <strong>middel</strong>(en). Het <strong>doel</strong> is een correct werkende <strong>applicatie</strong> die bestaat om een <strong>bedrijfsproces te ondersteunen</strong>. IT&#8217;ers die dat begrijpen en pragmatisch handelen, kunnen rekenen op mooie carriÃ¨re opportuniteiten.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_uitvoeren"><a class="anchor" href="#_uitvoeren"></a>Uitvoeren ðŸŒŸ</h2>
<div class="sectionbody">
<div class="paragraph">
<p>De refactoring werd slechts gedeeltelijk klassikaal doorgevoerd. Download de relevante code van GitHub en werk de refactoring af. Zoek in de code naar <code>TODO</code> hints indien je niet goed weet waar te beginnen.</p>
</div>
<div class="paragraph">
<p>Er zijn zeker nog andere verbeterpunten te vinden in onze solution. Idealiter komen we daar op terug wanneer we verder zouden werken aan de applicatie. We proberen de <a href="https://iq.opengenus.org/boy-scout-rule/">Boy Scout Rule</a> toe te passen.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_referenties"><a class="anchor" href="#_referenties"></a>Referenties</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://learn.microsoft.com/en-us/dotnet/framework/data/adonet/ado-net-code-examples">ADO.NET</a></p>
</div>
<div class="paragraph">
<p><a href="https://learn.microsoft.com/en-us/ef/core/">EF Core</a></p>
</div>
<div class="paragraph">
<p><a href="https://github.com/PomeloFoundation/Pomelo.EntityFrameworkCore.MySql">Pomelo.EntityFrameworkCore.MySql</a></p>
</div>
<div class="paragraph">
<p><a href="https://en.wikipedia.org/wiki/Indirection">Level of Indirection</a></p>
</div>
<div class="paragraph">
<p><a href="https://en.wikipedia.org/wiki/Code_refactoring">Refactoring</a></p>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <p>This page was built using a customized version of the Antora default UI.</p>
  <p>The source code for the default UI is licensed under the terms of the MPL-2.0 license.</p>
    <p>Content by Stefan Courteaux unless otherwise noted. </p>
</footer>
<script id="site-script" src="../_/js/site.js" data-ui-root-path="../_"></script>
<script async src="../_/js/vendor/highlight.js"></script>
  </body>
</html>
