<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Observer Pattern :: Softwareontwerp 2 (BETA)</title>
    <meta name="generator" content="Antora 3.1.10">
    <link rel="stylesheet" href="../_/css/site.css">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="#">Softwareontwerp 2 (BETA)</a>
      <button class="navbar-burger" aria-controls="topbar-nav" aria-expanded="false" aria-label="Toggle main menu">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
      
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
          <div class="navbar-item has-dropdown is-hoverable">
              <a class="navbar-link" href="#">Producten</a>
              <div class="navbar-dropdown">
                  <a class="navbar-item" target="_blank" href="https://learn.microsoft.com/en-us/cli/azure/">Azure CLI</a>
                  <a class="navbar-item" target="_blank" href="https://www.docker.com/products/docker-desktop">Docker Desktop</a>
                  <a class="navbar-item" target="_blank" href="https://desktop.github.com/download">GitHub Desktop</a>
                  <a class="navbar-item" target="_blank" href="https://www.mysql.com/products/workbench">MySQL Workbench</a>
                  <a class="navbar-item" target="_blank" href="https://www.postman.com/downloads/">Postman</a>
                  <a class="navbar-item" target="_blank" href="https://www.jetbrains.com/rider/download">Rider</a>
                  <a class="navbar-item" target="_blank" href="https://code.visualstudio.com/download">VS Code</a>
              </div>
          </div>
          <div class="navbar-item has-dropdown is-hoverable">
              <a class="navbar-link" href="#">Diensten</a>
              <div class="navbar-dropdown">
                  <a class="navbar-item" target="_blank" href="https://dev.azure.com/hogent-web4-stefancourteaux/">Azure DevOps</a>
                  <a class="navbar-item" target="_blank" href="https://portal.azure.com">Azure Portal</a>
                  <a class="navbar-item" target="_blank" href="https://chamilo.hogent.be">Chamilo</a>
                  <a class="navbar-item" target="_blank" href="https://github.com">GitHub</a>
                  <a class="navbar-item" target="_blank" href="https://jwt.io">JWT.io</a>                  
                  <a class="navbar-item" target="_blank" href="https://dotnet.microsoft.com">MS Docs</a>
              </div>
          </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="o2" data-version="">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <button class="nav-menu-toggle" aria-label="Toggle expand/collapse all" style="display: none"></button>
    <h3 class="title"><a href="index.html">Ontwerp 2</a></h3>
<ul class="nav-list">
      <li class="nav-item is-active" data-depth="0">
<ul class="nav-list">
      <li class="nav-item is-active" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Basis OO Ontwerp</span>
<ul class="nav-list">
      <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="01-klassen-objecten.html">Klassen &amp; Objecten</a>
  </li>
      <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="02-DCD-Overerving.html">DCD &amp; Overerving</a>
  </li>
      <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="03-RDD-GRASP.html">GRASP &amp; SSD</a>
  </li>
      <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="04-opdracht.html">Oefening Scheepvaart</a>
  </li>
</ul>
  </li>
      <li class="nav-item is-active" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Design Patterns &amp; Refactoring</span>
<ul class="nav-list">
      <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="11-patterns-game.html">State Pattern (2 Lessen)</a>
  </li>
      <li class="nav-item is-active is-current-page" data-depth="2">
    <a class="nav-link" href="14-observer.html">Observer Pattern</a>
  </li>
      <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="12-opdracht.html">Groepswerk</a>
  </li>
      <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="13-presentaties.html">Presentaties</a>
  </li>
</ul>
  </li>
      <li class="nav-item is-active" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Architectuur</span>
<ul class="nav-list">
      <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="20-workshop.html">Workshop</a>
  </li>
      <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="21-restful.html">RESTful API&#8217;s</a>
  </li>
      <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="22-concepten.html">Concepten</a>
  </li>
      <li class="nav-item is-active" data-depth="2">
    <a class="nav-link" href="99-opdracht-3.html">Eindopdracht ðŸŒ¦</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Ontwerp 2</span>
    <span class="version"></span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <div class="title"><a href="index.html">Ontwerp 2</a></div>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">Ontwerp 2</a></li>
    <li>Design Patterns &amp; Refactoring</li>
    <li><a href="14-observer.html">Observer Pattern</a></li>
  </ul>
</nav>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Observer Pattern</h1>
<div class="sect1">
<h2 id="_probleemstelling"><a class="anchor" href="#_probleemstelling"></a>Probleemstelling</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Wanneer het wijzigen van de toestand (<em>state</em>) van een bepaald object impact heeft op 1-of-meer andere objecten, zouden we al snel een ontwerp uitzetten waarin er een expliciete associatie bestaat tussen deze object types (klassen).</p>
</div>
<div class="paragraph text-center">
<p><span class="image"><img src="_images/observer/observer-impact.png" alt="observer impact"></span></p>
</div>
<div class="paragraph">
<p>Wanneer de relevante state wijziging gebeurt, zal logica in A veranderingen in B doorvoeren.</p>
</div>
<div class="paragraph">
<p>Stel je voor dat de geÃ¯mpacteerde objecten daarenboven van verschillende types kunnen zijn. Nu moeten we in A expliciete lijsten van verschillende types beheren en de relevante methodes aanroepen bij state changes.</p>
</div>
<div class="paragraph text-center">
<p><span class="image"><img src="_images/observer/observer-niet-schaalbaar.png" alt="observer niet schaalbaar"></span></p>
</div>
<div class="listingblock">
<div class="title">Mogelijk Implementatie Klasse A</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-csharp hljs" data-lang="csharp">public class A
{
    private int intjeMetImpact = -1;

    private List&lt;B&gt; DeBeetjes = new();
    private List&lt;C&gt; DeCeetjes = new();
    private List&lt;D&gt; DeDeetjes = new();

    public void VeranderIets()
    {
        intjeMetImpact++;

        foreach(var b in DeBeetjes)
            b.DoeDit();

        foreach(var c in DeCeetjes)
            c.DoeDat();

        foreach(var c in DeCeetjes)
            b.HetIsMeWat();
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Dit werkt. De computer zal niet klagen, maar een developer wel. De oplossing is niet schaalbaar. Er is <em>tight coupling</em> tussen A en B,C,D. We hebben een elegantere oplossing nodig met <em>loose coupling</em> waar A zoveel niet hoeft te weten over de geÃ¯mpacteerde objecten.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_observer_pattern"><a class="anchor" href="#_observer_pattern"></a>Observer Pattern</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In plaats van de afhankelijkheden expliciet te hardcoden, kunnen we het geheel abstracter implementeren.</p>
</div>
<div class="paragraph">
<p>We kunnen stellen dat er iets is, een onderwerp (<em>subject</em>), namelijk <code>A</code>. Andere types <code>B</code>, <code>C</code>, <code>D</code> moeten reageren op toestandsveranderingen van <code>A</code>. De types die interesse hebben in de toestandsverandering zullen we <em>observers</em> noemen. We kunnen dus ook stellen dat <code>A</code> <em>observable</em> moet zijn.</p>
</div>
<div class="paragraph">
<p>Dit paradigma kunnen we vastleggen aan de hand van abstracte klassen.</p>
</div>
<div class="sect2">
<h3 id="_uml"><a class="anchor" href="#_uml"></a>UML</h3>
<div class="paragraph text-center">
<p><span class="image"><img src="_images/observer/observer-implemented.png" alt="observer implemented"></span></p>
</div>
<div class="paragraph">
<p>Nu is er sprake van <em>loose coupling</em>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Er is geen concrete associatie tussen de types <code>A</code> en <code>A</code>, <code>B</code>, <code>C</code>.</p>
</li>
<li>
<p>De interne keuken van <code>A</code>, <code>B</code>, <code>C</code> is <code>private</code>.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_c_abstractie"><a class="anchor" href="#_c_abstractie"></a>C# Abstractie</h3>
<div class="listingblock">
<div class="title">AbstractObserver</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-csharp hljs" data-lang="csharp">public abstract class AbstractObserver
{
    public abstract void Update(); <i class="conum" data-value="1"></i><b>(1)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Een klasse die erft van AbstractObserver zal <code>Update()</code> moeten implementeren.<br>
Wat die methode concreet zal doen, kan (en zal) verschillen voor <code>A</code>, <code>B</code>, <code>C</code> etc.</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">AbstractObservable</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-csharp hljs" data-lang="csharp">public abstract class AbstractObservable
{
    private List&lt;AbstractObserver&gt; _observers = []; <i class="conum" data-value="1"></i><b>(1)</b>

    public void RegisterObserver(AbstractObserver observer) <i class="conum" data-value="1"></i><b>(1)</b>
    {
        _observers.Add(observer);
    }

    public void RemoveObserver(AbstractObserver observer) <i class="conum" data-value="1"></i><b>(1)</b>
    {
        _observers.Remove(observer);
    }

    public void NotifyObservers() <i class="conum" data-value="2"></i><b>(2)</b>
    {
        foreach (var observer in _observers)
        {
            observer.Update();
        }
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Een <em>Observable</em> kent een lijst van observeerders en bevat de nodige logica om deze lijst te managen.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Wanneer de toestand van het <em>subject</em> (= de <em>observable) verandert, zal deze alle _observers</em> verwittigen aan de hand van de <code>Update()</code> methode.</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_c_implementatie"><a class="anchor" href="#_c_implementatie"></a>C# Implementatie</h3>
<div class="paragraph">
<p>De klasse <code>A</code> wordt niet langer "vervuild" door referenties naar instanties van geÃ¯nteresseerde objecten.</p>
</div>
<div class="listingblock">
<div class="title">A</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-csharp hljs" data-lang="csharp">public class A : AbstractObservable
{
    private int intjeMetImpact = -1;

    public void VeranderIets()
    {
        intjeMetImpact++;

        NotifyObservers();
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>De klassen <code>B</code>, <code>C</code> en <code>D</code> hoeven hun interne keuken ook niet langer de <em>exposen</em>. De hook naar het <em>observer-observable</em> verhaal zit in de abstracte <em>base class</em>.</p>
</div>
<div class="listingblock">
<div class="title">B</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-csharp hljs" data-lang="csharp">public class B : AbstractObserver
{
    public override void Update()
    {
        DoeDit();
    }

    private void DoeDit()
    {
        // interne keuken
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">C</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-csharp hljs" data-lang="csharp">public class C : AbstractObserver
{
    public override void Update()
    {
        DoeDat();
    }

    private void DoeDat()
    {
        // interne keuken
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">D</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-csharp hljs" data-lang="csharp">public class D : AbstractObserver
{
    public override void Update()
    {
        HetIsMeWat();
    }

    private void HetIsMeWat()
    {
        // interne keuken
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_relatie_beheren"><a class="anchor" href="#_relatie_beheren"></a>Relatie Beheren</h2>
<div class="sectionbody">
<div class="paragraph">
<p>De relatie tussen <em>observer</em> en <em>observable</em> moet extern beheerd worden.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-csharp hljs" data-lang="csharp">var a = new A();

var b = new B();

var c = new C();
var c2 = new C();

var d = new D();

a.AddObserver(b);
a.AddObserver(c);
a.AddObserver(c);
a.AddObserver(d);

// ...

a.RemoveObserver(c);

// ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Je kan een specifieke klasse in het leven roepen om dit te beheren, of het <em>gewoon</em> deel laten uitmaken van andere applicatielogica. Dat is sterk afhankelijk van het grotere geheel.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_bestaande_implementaties"><a class="anchor" href="#_bestaande_implementaties"></a>Bestaande Implementaties</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Microsoft voorziet een opinionated <a href="https://learn.microsoft.com/en-us/dotnet/standard/events/observer-design-pattern">implementatie</a>.</p>
</li>
<li>
<p>UI broncode zal vaak steunen op het observer pattern voor het synchroniseren van databound elementen in, bijvoorbeeld, <a href="https://learn.microsoft.com/en-us/dotnet/maui/xaml/fundamentals/mvvm?view=net-maui-9.0">MVVM context</a>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_commands_events"><a class="anchor" href="#_commands_events"></a>Commands &amp; Events</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Door het observer pattern toe te passen kunnen we het conceptuele verschil tussen instructies (<em>commands</em>) en meldingen (<em>events</em>) introduceren.</p>
</div>
<div class="paragraph">
<p>De originele <code>A</code> besliste expliciet om <code>b.DoeDit()</code> aan te roepen. "Jij moet nu dit doen"_.</p>
</div>
<div class="paragraph">
<p>De nieuwe <code>A</code> zegt tegen de observers (ongeacht het concrete type) <em>"Weet dat ik geÃ¼pdatet ben - just saying"</em>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_service_bus"><a class="anchor" href="#_service_bus"></a>Service Bus</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Vaak kan je een conceptueel idee toepassen op geschaald niveau, van micro tot macro. Wanneer we de macro versie van het Observer patroon bekijken, landen we bij een <em>service bus</em>, zoals bijvoorbeeld <a href="https://learn.microsoft.com/en-us/azure/service-bus-messaging/service-bus-messaging-overview">Azure Service Bus</a>.</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Een service bus is een infrastructuurcomponent in softwarearchitectuur die communicatie tussen verschillende applicaties en diensten faciliteert. Het fungeert als een tussenlaag die berichten verzendt en ontvangt, waardoor losse koppeling en schaalbaarheid mogelijk zijn.</p>
</div>
</blockquote>
<div class="attribution">
&#8212; Copilot
</div>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <p>This page was built using a customized version of the Antora default UI.</p>
  <p>The source code for the default UI is licensed under the terms of the MPL-2.0 license.</p>
    <p>Content by Stefan Courteaux unless otherwise noted. </p>
</footer>
<script id="site-script" src="../_/js/site.js" data-ui-root-path="../_"></script>
<script async src="../_/js/vendor/highlight.js"></script>
  </body>
</html>
